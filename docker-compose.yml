services:
  db: # can change
    image: postgres:16
    restart: always
    environment:
      - POSTGRES_DB=${POSTGRES_DB}
      - POSTGRES_USER=${POSTGRES_USER}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
    volumes:
      - db-data:/var/lib/postgresql/data
    networks:
      - back-tier

  server: # http://localhost:8080/about.json
    build: ./server
    environment:
      - POSTGRES_USER=${POSTGRES_USER}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
    networks:
      - back-tier
    ports: # application server on port 8080
      - '8080:8080'
    depends_on:
      - db

  client_mobile:
    build: ./mobile
    volumes: # The services client_mobile and client_web will share a common volume
      - common:/apk # normalement ce truc marche (par piti√©, y a 0 doc)
    depends_on:
      - server

  client_web: # http://localhost:8081/client.apk
    build: ./web
    volumes: # The services client_mobile and client_web will share a common volume
      - common:/apk
    ports: # web client on port 8081
      - '8081:8081'
    depends_on: # The client_web depends on client_mobile AND server.
      - server
      - client_mobile
    networks:
      - back-tier

networks:
  back-tier: {}

volumes:
  common: {}
  db-data: {}